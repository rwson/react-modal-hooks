"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,a=require("immer"),o=e(a),r=require("react"),n=e(r);function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e}).apply(this,arguments)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,o=new Array(t);a<t;a++)o[a]=e[a];return o}function i(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return d(e,void 0);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?d(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}!function(e){e.OpenModal="OpenModal",e.UpdateModal="UpdateModal",e.CloseModal="CloseModal",e.CloseAllModals="CloseAllModals",e.RemoveModal="RemoveModal",e.RegisterModal="RegisterModal",e.LazyModalLoaded="LazyModalLoaded",e.LoadLazyModal="LoadLazyModal"}(t||(t={}));var s=new Map,u=o((function(e,a){var o,r=null!=(o=a.payload)?o:{},n=r.id,d=r.props,i=r.component,s=r.loadFailed,u=r.loaded,c=r.__mergeProps___,p=Array.from(e.keys()),f=e.has(n),v=e.get(n);switch(a.type){case t.OpenModal:return v&&(v.visible=!0,v.props=Object.assign({},null!=d?d:{}),e.set(n,v)),e;case t.UpdateModal:if(v){var M,y={};c&&(y=null!=(M=v.props)?M:{}),v.props=Object.assign({},y,null!=d?d:{}),e.set(n,v)}return e;case t.CloseModal:return v&&(v.visible=!1,e.set(n,v)),e;case t.CloseAllModals:return p.forEach((function(t){(v=e.get(t)).visible=!1,e.set(t,v)})),e;case t.RegisterModal:return f||e.set(n,l({},a.payload,{id:n,props:{}})),e;case t.RemoveModal:return e.delete(n),e;case t.LoadLazyModal:return v&&(v.loading=!0,v.loadFailed=!1),e;case t.LazyModalLoaded:return v&&(v.loaded=u,v.loadFailed=s,v.loading=!1,v.component=i,e.set(n,v)),e;default:return e}})),c=function(e){var t=e.render,a=e.visible,o=e.renderProps;if(!a||!t)return null;var r=Object.assign({},null!=o?o:{},{visible:a});return n.createElement(n.Fragment,null,t(r))},p=function(){var e=v(),a=e.state,o=e.dispatch,d=e.defaultProps,s=r.useMemo((function(){for(var e,t=[],o=i(a.values());!(e=o()).done;){var n=e.value;n.component&&t.push(r.createElement(c,l({},d||{},{render:n.component,renderProps:n.props,visible:n.visible,key:n.id})))}return t}),[a]);return r.useEffect((function(){for(var e,r=function(){var a=e.value;if(a.isLazy&&!a.loaded){o(t.LoadLazyModal,{id:a.id});var r=a.loader;null==r||r().then((function(e){o(t.LazyModalLoaded,{id:a.id,component:e.default,loadFailed:!1,loaded:!0})}))}},n=i(a.values());!(e=n()).done;)r()}),[a]),n.createElement(n.Fragment,null,s)},f=r.createContext({state:s,dispatch:function(){},defaultProps:{}});f.displayName="RMBH_Context";var v=function(){return r.useContext(f)};a.enableAllPlugins(),exports.ModalProvider=function(e){var t=e.children,a=e.defaultProps,o=void 0===a?{}:a,l=r.useReducer(u,s),d=l[0],i=l[1],c=r.useCallback((function(e,t){i({type:e,payload:t})}),[]);return n.createElement(f.Provider,{value:{state:d,defaultProps:o,dispatch:c}},n.createElement(n.Fragment,null,n.createElement(p,null),t))},exports.useCloseModal=function(){var e=v().dispatch;return{closeModal:function(a){return e(t.CloseModal,{id:a})},closeAllModals:function(){return e(t.CloseAllModals)}}},exports.useModalIsLoading=function(e){var t=v().state;return r.useMemo((function(){var a=(Array.isArray(e)?e:[e]).map((function(e){return t.get(e)})).filter(Boolean);return!!a.length&&a.some((function(e){return!(null==e||!e.isLazy)&&e.loading}))}),[t,e])},exports.useOpenModal=function(){r.useState(!1);var e=v(),a=e.state,o=e.dispatch;return function(e,r){var n=a.get(e),l=null!=r?r:{};if(null!=n&&n.isLazy&&(null==n||!n.loaded)&&!n.loading){var d=n.loader;return o(t.LoadLazyModal,{id:e}),void(null==d||d().then((function(a){o(t.LazyModalLoaded,{id:n.id,component:a.default,loadFailed:!1,loaded:!0}),setTimeout((function(){o(t.OpenModal,{id:e,props:l})}),30)})))}o(t.OpenModal,{id:e,props:l})}},exports.useRegisterModal=function(e){var a=v(),o=a.dispatch,n=a.state,d=(r.useRef(!1),r.useMemo((function(){return Object.keys(e).reduce((function(t,a){var o;return n.get(a)?t:l({},t,((o={})[a]=e[a],o))}),{})}),[e,n]));r.useEffect((function(){Object.keys(d).forEach((function(e){var a=d[e],r={id:e,isLazy:a.isLazy,component:a.component,loader:a.loader};r.isLazy&&(r.loaded=!1,r.loading=!1,r.loadFailed=!1),o(t.RegisterModal,r)}))}),[d])},exports.useUpdateModal=function(){var e=v(),a=e.dispatch;return r.useCallback((function(e,o){a(t.UpdateModal,{id:e,props:o.props,__mergeProps___:o.merge})}),[e.state])};
//# sourceMappingURL=react-modal-better-hooks.cjs.production.min.js.map
