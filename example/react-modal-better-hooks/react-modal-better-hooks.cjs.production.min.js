"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,o=require("immer"),r=e(o),a=require("react"),n=e(a);function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e}).apply(this,arguments)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function i(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return(o=o.call(e)).next.bind(o);if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return d(e,void 0);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?d(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}!function(e){e.OpenModal="OpenModal",e.UpdateModal="UpdateModal",e.CloseModal="CloseModal",e.CloseAllModals="CloseAllModals",e.RemoveModal="RemoveModal",e.RegisterModal="RegisterModal",e.LazyModalLoaded="LazyModalLoaded",e.LoadLazyModal="LoadLazyModal"}(t||(t={}));var u=new Map,s=r((function(e,o){var r,a=null!=(r=o.payload)?r:{},n=a.id,d=a.props,i=a.component,u=a.loadFailed,s=a.loaded,c=a.__mergeProps___,p=Array.from(e.keys()),f=e.has(n),v=e.get(n);switch(o.type){case t.OpenModal:return v&&(v.visible=!0,v.props=Object.assign({},null!=d?d:{}),e.set(n,v)),e;case t.UpdateModal:if(v){var y,M={};c&&(M=null!=(y=v.props)?y:{}),v.props=Object.assign({},M,null!=d?d:{}),e.set(n,v)}return e;case t.CloseModal:return console.log(o.type,v),v&&(v.visible=!1,e.set(n,v)),e;case t.CloseAllModals:return p.forEach((function(t){(v=e.get(t)).visible=!1,e.set(t,v)})),e;case t.RegisterModal:return f||e.set(n,l({},o.payload,{id:n,props:{}})),e;case t.RemoveModal:return e.delete(n),e;case t.LoadLazyModal:return v&&(v.loading=!0,v.loadFailed=!1),e;case t.LazyModalLoaded:return v&&(v.loaded=s,v.loadFailed=u,v.loading=!1,v.component=i,e.set(n,v)),e;default:return e}})),c=function(e){var t=e.render,o=e.visible,r=e.renderProps;if(!o||!t)return null;var a=Object.assign({},null!=r?r:{},{visible:o});return n.createElement(n.Fragment,null,t(a))},p=function(){var e=v(),o=e.state,r=e.dispatch,d=e.defaultProps,u=a.useMemo((function(){for(var e,t=[],r=i(o.values());!(e=r()).done;){var n=e.value;n.component&&t.push(a.createElement(c,l({},d||{},{render:n.component,renderProps:n.props,visible:n.visible,key:n.id})))}return t}),[o]);return a.useEffect((function(){for(var e,a=function(){var o=e.value;if(o.isLazy&&!o.loaded){r(t.LoadLazyModal,{id:o.id});var a=o.loader;null==a||a().then((function(e){r(t.LazyModalLoaded,{id:o.id,component:e.default,loadFailed:!1,loaded:!0})}))}},n=i(o.values());!(e=n()).done;)a()}),[o]),n.createElement(n.Fragment,null,u)},f=a.createContext({state:u,dispatch:function(){},defaultProps:{}});f.displayName="RMBH_Context";var v=function(){return a.useContext(f)};o.enableAllPlugins(),exports.ModalProvider=function(e){var t=e.children,o=e.defaultProps,r=void 0===o?{}:o,l=a.useReducer(s,u),d=l[0],i=l[1],c=a.useCallback((function(e,t){i({type:e,payload:t})}),[]);return n.createElement(f.Provider,{value:{state:d,defaultProps:r,dispatch:c}},n.createElement(n.Fragment,null,n.createElement(p,null),t))},exports.useCloseModal=function(){var e=v().dispatch;return{closeModal:function(o){return e(t.CloseModal,{id:o})},closeAllModals:function(){return e(t.CloseAllModals)}}},exports.useModalIsLoading=function(e){var t=v().state;return a.useMemo((function(){var o=(Array.isArray(e)?e:[e]).map((function(e){return t.get(e)})).filter(Boolean);return!!o.length&&o.some((function(e){return!(null==e||!e.isLazy)&&e.loading}))}),[t,e])},exports.useOpenModal=function(){a.useState(!1);var e=v(),o=e.state,r=e.dispatch;return function(e){var a=e.modalId,n=e.props,l=o.get(a);if(null!=l&&l.isLazy&&(null==l||!l.loaded)&&!l.loading){var d=l.loader;return r(t.LoadLazyModal,{id:a}),void(null==d||d().then((function(e){r(t.LazyModalLoaded,{id:l.id,component:e.default,loadFailed:!1,loaded:!0}),setTimeout((function(){r(t.OpenModal,{id:a,props:n})}),30)})))}r(t.OpenModal,{id:a,props:n})}},exports.useRegisterModal=function(){return function(e,o){var r=v(),n=r.dispatch,d=r.state,i=a.useRef(!1),u=a.useMemo((function(){return Object.keys(e).reduce((function(t,o){var r;return d.get(o)?t:l({},t,((r={})[o]=e[o],r))}),{})}),[e,d]);a.useEffect((function(){Object.keys(u).forEach((function(e){var o=u[e],r={id:e,isLazy:o.isLazy,component:o.component,loader:o.loader};r.isLazy&&(r.loaded=!1,r.loading=!1,r.loadFailed=!1),n(t.RegisterModal,r)}))}),[u]),a.useEffect((function(){return i.current||(i.current=!0),function(){!o&&i.current&&Object.keys(e).forEach((function(e){n(t.RemoveModal,{id:e})}))}}),[e,o])}},exports.useUpdateModal=function(){var e=v(),o=e.state,r=e.dispatch;return a.useCallback((function(e){var a=e.modalId,n=e.merge,l=e.props;o.get(a),r(t.UpdateModal,{id:a,props:l,__mergeProps___:n})}),[o])};
//# sourceMappingURL=react-modal-better-hooks.cjs.production.min.js.map
