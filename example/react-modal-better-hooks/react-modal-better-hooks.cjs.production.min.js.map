{"version":3,"file":"react-modal-better-hooks.cjs.production.min.js","sources":["../../src/constants.ts","../../src/reducer.ts","../../src/components/WrappedModal.tsx","../../src/components/ModalAutoMounter.tsx","../../src/context.tsx","../../src/index.ts","../../src/hooks/useCloseModal.ts","../../src/hooks/useOpenModal.ts","../../src/hooks/useRegisterModal.ts","../../src/hooks/useUpdateModal.ts"],"sourcesContent":["export enum ModalActionType {\n  OpenModal = 'OpenModal',\n  UpdateModal = 'UpdateModal',\n  CloseModal = 'CloseModal',\n  CloseAllModals = 'CloseAllModals',\n\n  RemoveModal = 'RemoveModal',\n  RegisterModal = 'RegisterModal',\n  LazyModalLoaded = 'LazyModalLoaded',\n  LoadLazyModal = 'LoadLazyModal'\n}\n","import { ComponentType } from 'react'\nimport produce from 'immer'\n\nimport { ModalActionType } from './constants'\nimport { Importer, CloseModalParams, OpenModalParams, AddLazyModalParams, ActionsMap, Actions, ModalItem, ModalStateMap } from './types'\n\nexport const initialState = new Map()\n\nexport const reducer = produce(\n  (state: ModalStateMap, action: Actions): ModalStateMap => {\n    const { id: payloadId, props: payloadProps, loader, component, loadFailed, shouldComponentLoad, loaded, __mergeProps___ } = action.payload ?? {}\n    const allKeys: Array<string> = Array.from(state.keys())\n    const registed: boolean = state.has(payloadId)\n\n    let currentModal: ModalItem | undefined = state.get(payloadId)\n\n    switch (action.type) {\n      case ModalActionType.OpenModal:\n        if (currentModal) {\n          currentModal.visible = true\n          currentModal.props = Object.assign({}, payloadProps ?? {})\n\n          state.set(payloadId, currentModal as ModalItem)\n        }\n\n        return state\n\n      case ModalActionType.UpdateModal:\n        if (currentModal) {\n          let oldPorps = {}\n          if (__mergeProps___) {\n            oldPorps = currentModal.props ?? {}\n          }\n          currentModal.props = Object.assign({}, oldPorps, payloadProps ?? {})\n          state.set(payloadId, currentModal as ModalItem)\n        }\n      return state\n\n      case ModalActionType.CloseModal:\n        if (currentModal) {\n          currentModal.visible = false\n          state.set(payloadId, currentModal)\n\n          console.log(currentModal)\n        }\n        return state\n\n      case ModalActionType.CloseAllModals:\n        allKeys.forEach((key: string) => {\n          currentModal = state.get(key) as ModalItem\n          currentModal.visible = false\n          state.set(key, currentModal)\n        })\n        return state\n\n      case ModalActionType.RegisterModal:\n        if (!registed) {\n          state.set(payloadId, {\n            ...action.payload,\n            id: payloadId,\n            props: {}\n          } as ModalItem)\n        }\n        return state\n\n      case ModalActionType.LoadLazyModal:\n        if (currentModal) {\n          currentModal.loading = true\n          currentModal.loadFailed = false\n        }\n        return state\n\n      case ModalActionType.LazyModalLoaded:\n        if (currentModal) {\n          currentModal.loaded = loaded\n          currentModal.loadFailed = loadFailed\n          currentModal.loading = false\n          currentModal.component = component\n          state.set(payloadId, currentModal as ModalItem)\n        }\n        return state\n\n      default:\n        return state\n    }\n  }\n)\n","import React, { FC, ReactElement } from 'react'\n\ninterface WrappedModalProps {\n  render: any\n  visible: boolean\n  renderProps?: Record<string, any>\n}\n\nexport const WrappedModal: FC<WrappedModalProps> = ({\n  render,\n  visible,\n  renderProps\n}): ReactElement | null => {\n  if (!visible || !render) {\n    return null\n  }\n\n  const props = Object.assign({}, (renderProps ?? {}), { visible })\n  return <>{render(props)}</>\n}\n","import React, { FC, useEffect, useMemo, createElement, ReactElement } from 'react'\n\nimport { useModalContext } from '../context'\nimport { ModalItem } from '../types'\nimport { ModalActionType } from '../constants'\nimport { WrappedModal } from './WrappedModal'\n\nexport const ModalAutoMounter: FC = () => {\n  const { state, dispatch } = useModalContext()\n  const mountableCompnent = useMemo(() => {\n    const entries: IterableIterator<ModalItem> = state.values()\n    const components: ReactElement[] = []\n\n    for (const entry of entries) {\n      if (entry.component) {\n        components.push(createElement(WrappedModal, {\n          render: entry.component,\n          renderProps: entry.props,\n          visible: entry.visible,\n          key: entry.id\n        }))\n      }\n    }\n\n    return components\n  }, [state])\n\n  useEffect(() => {\n    const entries = state.values()\n\n    for (const entry of entries) {\n      if (entry.isLazy && !entry.loaded) {\n        dispatch(ModalActionType.LoadLazyModal, {\n          id: entry.id\n        })\n\n        try {\n          const loader = entry.loader\n          loader?.().then((instance) => {\n            dispatch(ModalActionType.LazyModalLoaded, {\n              id: entry.id,\n              component: instance.default,\n              loadFailed: false,\n              loaded: true\n            })\n          })\n\n        } catch (err) {\n\n        }\n      }\n    }\n  }, [state])\n\n  return (\n    <>\n      {mountableCompnent}\n    </>\n  )\n}\n\n","import React, {\n  createContext,\n  useReducer,\n  useCallback,\n  useContext,\n  FC,\n  PropsWithChildren,\n} from 'react'\n\nimport {\n  reducer,\n  initialState\n} from './reducer'\nimport {\n  ModalStateMap,\n  Actions,\n  ActionsMap,\n  Dispatcher,\n  ModalProviderProps\n} from './types'\n\nimport { ModalAutoMounter } from './components/ModalAutoMounter'\n\nconst ModalContext = createContext<{\n  state: ModalStateMap\n  dispatch: Dispatcher\n  defaultProps: ModalProviderProps\n}>({\n  state: initialState,\n  dispatch: () => undefined,\n  defaultProps: {},\n})\n\nModalContext.displayName = 'RMBH_Context'\n\nexport const ModalProvider: FC<PropsWithChildren<{\n  defaultProps: ModalProviderProps\n}>> = ({ children, defaultProps = {} }) => {\n  const [state, dispatch] = useReducer(reducer, initialState)\n\n  //  @ts-ignore\n  const dispatchAction: Dispatcher = useCallback((type, payload) => {\n    dispatch({ type, payload })\n  }, [])\n\n  const value = {\n    state,\n    defaultProps,\n    dispatch: dispatchAction,\n  }\n\n  return (\n    <ModalContext.Provider value={value}>\n      <>\n        <ModalAutoMounter />\n        {children}\n      </>\n    </ModalContext.Provider>\n  )\n}\n\nexport const useModalContext = (): {\n  state: ModalStateMap\n  dispatch: Dispatcher\n  defaultProps: ModalProviderProps\n} => useContext(ModalContext)\n","import { enableAllPlugins } from 'immer'\n\nenableAllPlugins()\n\nexport { ModalProvider } from './context'\n// export { withModals } from './register'\n\nexport { useOpenModal } from './hooks/useOpenModal'\nexport { useCloseModal } from './hooks/useCloseModal'\nexport { useUpdateModal } from './hooks/useUpdateModal'\nexport { useRegisterModal } from './hooks/useRegisterModal'\n\nexport { ModalBasicProps } from './types'\n","import { ModalActionType } from '../constants'\nimport { useModalContext } from '../context'\n\ninterface UseCloseModalReutrn {\n  closeModal(modalId: string): void\n  closeAllModals(): void\n}\n\nexport const useCloseModal = (): UseCloseModalReutrn => {\n  const { dispatch } = useModalContext()\n\n  const closeModal = (modalId: string) => dispatch(ModalActionType.CloseModal, { modalId })\n  const closeAllModals = () => dispatch(ModalActionType.CloseAllModals)\n\n  return {\n    closeModal,\n    closeAllModals\n  }\n}","import React, { useState } from 'react'\n\nimport { ModalActionType } from '../constants'\nimport { useModalContext } from '../context'\nimport { ModalItem } from '../types'\nimport { WrappedModalComponent } from '../wrapped'\n\ninterface OpenModalInput<T> {\n  readonly modalId: string\n  readonly props?: T\n}\n\ntype UseOpenModalReturn<T> = (params: OpenModalInput<T>) => void | undefined\n\nexport const useOpenModal = <T>(): UseOpenModalReturn<T> => {\n  const [ loading, setLoading ] = useState<boolean>(false)\n  const { state, dispatch, defaultProps } = useModalContext()\n\n  const open = ({ modalId, props }: OpenModalInput<T>): void | undefined => {\n    const modalItem = state.get(modalId)\n\n    if (modalItem?.isLazy && !modalItem?.loaded && !modalItem.loading) {\n      return\n    }\n\n    dispatch(ModalActionType.OpenModal, {\n      id: modalId,\n      props\n    })\n  }\n\n  return open\n}","import React, { ComponentType, useEffect, useMemo } from 'react'\n\nimport { useModalContext } from '../context'\nimport { Importer } from '../types'\nimport { ModalActionType } from '../constants'\n\ninterface ModalRegisterItem {\n  readonly isLazy?: boolean\n  readonly component?: ComponentType\n  readonly loader?: Importer\n}\n\ntype RegisterModalInput = Record<string, ModalRegisterItem>\n\ntype UseRegisterModalReturn = (modals: RegisterModalInput) => void\n\nexport const useRegisterModal = (): UseRegisterModalReturn => {\n  const register = (modals: RegisterModalInput): void => {\n    const { dispatch, state } = useModalContext()\n\n    const diffModals = useMemo(() => {\n      return Object.keys(modals).reduce((result: RegisterModalInput, modalId: string) => {\n        if (state.get(modalId)) {\n          return result\n        }\n        \n        return {\n          ...result,\n          [modalId]: modals[modalId]\n        }\n      }, {})\n    }, [modals, state])\n\n    useEffect(() => {\n      Object.keys(diffModals).forEach((modalId: string) => {\n        const registerItem = diffModals[modalId]\n\n        const modalItem: Record<string, any> = {\n          id: modalId,\n          isLazy: registerItem.isLazy,\n          component: registerItem.component,\n          loader: registerItem.loader\n        }\n\n        if (modalItem.isLazy) {\n          modalItem.loaded = false\n          modalItem.loading = false\n          modalItem.loadFailed = false\n        }\n\n        dispatch(ModalActionType.RegisterModal, modalItem)\n      })\n    }, [diffModals])\n  }\n\n  return register\n}\n","import React, { useCallback } from 'react'\n\nimport { ModalActionType } from '../constants'\nimport { useModalContext } from '../context'\nimport { ModalItem } from '../types'\n\ninterface UpdateModalInput<T> {\n  readonly modalId: string\n  readonly props?: T\n  readonly merge?: boolean\n}\n\ntype UseUpdateModalReturn<T> = (params: UpdateModalInput<T>) => void\n\nexport const useUpdateModal = <T>(): UseUpdateModalReturn<T> => {\n  const { state, dispatch } = useModalContext()\n\n  const update = useCallback(({ modalId, merge, props }: UpdateModalInput<T>): void => {\n    const modalItem = state.get(modalId)\n\n    dispatch(ModalActionType.UpdateModal, {\n      id: modalId,\n      props: (props as T)!,\n      __mergeProps___: merge\n    })\n  }, [state])\n\n  return update\n}"],"names":["ModalActionType","initialState","Map","reducer","produce","state","action","payload","payloadId","id","payloadProps","props","loader","component","loadFailed","shouldComponentLoad","loaded","__mergeProps___","allKeys","Array","from","keys","registed","has","currentModal","get","type","OpenModal","visible","Object","assign","set","UpdateModal","oldPorps","CloseModal","console","log","CloseAllModals","forEach","key","RegisterModal","LoadLazyModal","loading","LazyModalLoaded","WrappedModal","render","renderProps","React","ModalAutoMounter","useModalContext","dispatch","mountableCompnent","useMemo","components","values","entry","push","createElement","useEffect","isLazy","then","instance","err","ModalContext","createContext","defaultProps","displayName","useContext","enableAllPlugins","children","useReducer","dispatchAction","useCallback","Provider","value","closeModal","modalId","closeAllModals","useState","modalItem","modals","diffModals","reduce","result","registerItem","merge"],"mappings":"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"}